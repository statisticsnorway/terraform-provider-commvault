# Code generator

### ApiExplorer

The api client code is generated by the OpenAPI3 spec located in this folder by swagger-codegen.
The following command is used:
```shell
java -jar modules/swagger-codegen-cli/target/swagger-codegen-cli.jar generate \
   -i "<path to repo>/terraform-provider-commvault/pkg/commvault/ApiExplorerOpenAPI3.yaml" \
   -l go \
   -o "<path to repo>/terraform-provider-commvault/pkg/commvault/apiclient/apiexplorer" --additional-properties packageName=apiclient
```

Manual changes after generation:
- Rename the file `api_blackout_windows.go` -> `api_blackoutwindows.go`, since go do not build files with `windows.go` suffix unless we build on windows platform
- Changed content of `model_laptops_list.go` ->
  ```go
    package apiclient
    
    type LaptopsList struct {
	    LaptopsListWebConsole   []LaptopsWebConsole
	    LaptopsListAdminConsole []LaptopsAdminConsole
    }
    ```
  
## Postman

The client code located in `apiclient/sp36` is generated from the postman collection located at https://documentation.commvault.com/2023e/essential/rest_api_postman.html -> https://documentation.commvault.com/2023e/essential/files/features/rest_api/JSON/Commvault_Rest_API_V1_Public_postman_collection.json . 

The collection was imported into postman and turned into OpenAPI-spec via postman. That openapi spec is saved as `Commvault_Rest_API_V1_Public_OpenApi3.yaml`

```shell
java -jar modules/swagger-codegen-cli/target/swagger-codegen-cli.jar generate \
   -i "<path to repo>/terraform-provider-commvault/pkg/commvault/Commvault_Rest_API_V1_Public_OpenApi3.yaml" \
   -l go \
   -o "<path to repo>/terraform-provider-commvault/pkg/commvault/apiclient/apiexplorer" --additional-properties packageName=apiclient
```


## Other

Why have apiclient as a own package?
We want the API client to be able to have a different lifecycle then the rest of the repo. 
Another reason is that we don't want the overhead of the whole collection of packages when we import this module from another project.
See: https://go.dev/wiki/Modules#faqs--multi-module-repositories